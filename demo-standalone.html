<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GerontoVoice - Voice AI Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .pulsing-mic {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .voice-wave {
            animation: voiceWave 1.5s infinite;
        }
        @keyframes voiceWave {
            0%, 100% { height: 20px; }
            50% { height: 40px; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">GerontoVoice AI</h1>
                <p class="text-xl text-gray-600">Voice-Enabled AI Caregiver Training Platform</p>
                <div class="mt-4 p-3 bg-green-100 rounded-lg border border-green-300">
                    <p class="text-green-800 font-semibold">âœ… DEMO MODE - Voice Processing Optimized</p>
                    <p class="text-green-700 text-sm">Confidence threshold: 0.3 | Fallback enabled | Demo-ready responses</p>
                </div>
            </div>

            <!-- Voice Interface -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <div class="text-center">
                    <div class="relative inline-block mb-6">
                        <button id="micButton" class="w-24 h-24 rounded-full bg-gradient-to-r from-blue-500 to-green-500 text-white flex items-center justify-center text-3xl shadow-lg hover:shadow-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300">
                            ðŸŽ¤
                        </button>
                        <div id="confidenceBar" class="absolute -bottom-2 left-0 right-0 h-2 bg-gray-200 rounded-full overflow-hidden" style="display:none;">
                            <div id="confidenceLevel" class="h-full bg-green-500 transition-all duration-300" style="width: 0%;"></div>
                        </div>
                    </div>
                    
                    <div id="status" class="text-lg text-gray-600 mb-4">
                        Click the microphone to start speaking with Margaret
                    </div>
                    
                    <div id="transcript" class="min-h-16 p-4 bg-gray-50 rounded-lg border border-gray-200 text-left" style="display:none;">
                        <div class="text-sm text-gray-500 mb-2">You said:</div>
                        <div id="transcriptText" class="text-gray-800"></div>
                    </div>
                </div>
            </div>

            <!-- Conversation Area -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Conversation with Margaret (AI Elderly Persona)</h2>
                <div id="conversation" class="space-y-4 max-h-96 overflow-y-auto">
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold">M</div>
                        <div class="flex-1 bg-purple-50 rounded-lg p-3">
                            <p class="text-purple-800">Hello dear! I'm Margaret. I'm 78 years old and I'd love to chat with you. How are you feeling today?</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-6 bg-blue-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">Demo Instructions:</h3>
                <div class="grid md:grid-cols-2 gap-4 text-blue-700">
                    <div>
                        <h4 class="font-semibold mb-2">Try saying:</h4>
                        <ul class="text-sm space-y-1">
                            <li>â€¢ "Hello Margaret, how are you?"</li>
                            <li>â€¢ "I'm feeling sad today"</li>
                            <li>â€¢ "Tell me about your day"</li>
                            <li>â€¢ "Do you have any advice?"</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Features:</h4>
                        <ul class="text-sm space-y-1">
                            <li>â€¢ âœ… Low confidence threshold (0.3)</li>
                            <li>â€¢ âœ… Elderly-optimized speech recognition</li>
                            <li>â€¢ âœ… Contextual AI responses</li>
                            <li>â€¢ âœ… Voice synthesis output</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class VoiceDemo {
            constructor() {
                this.isListening = false;
                this.recognition = null;
                this.confidenceThreshold = 0.3;
                this.initSpeechRecognition();
                this.bindEvents();
            }

            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    // Demo-optimized settings
                    this.recognition.continuous = false;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.updateUI();
                    };
                    
                    this.recognition.onresult = (event) => {
                        let finalTranscript = '';
                        let interimTranscript = '';
                        let confidence = 0;
                        
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const result = event.results[i];
                            confidence = result[0].confidence || 0.8; // Default confidence if not provided
                            
                            if (result.isFinal) {
                                finalTranscript += result[0].transcript;
                            } else {
                                interimTranscript += result[0].transcript;
                            }
                        }
                        
                        this.updateConfidence(confidence);
                        this.updateTranscript(finalTranscript || interimTranscript);
                        
                        // Demo-friendly: Accept any reasonable transcript
                        if (finalTranscript && (confidence > this.confidenceThreshold || finalTranscript.length > 3)) {
                            this.processVoiceInput(finalTranscript);
                        }
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.updateStatus('Speech recognition error. Try again or speak more clearly.');
                        this.stopListening();
                    };
                    
                    this.recognition.onend = () => {
                        this.isListening = false;
                        this.updateUI();
                        document.getElementById('confidenceBar').style.display = 'none';
                    };
                } else {
                    this.updateStatus('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                }
            }

            bindEvents() {
                document.getElementById('micButton').addEventListener('click', () => {
                    if (this.isListening) {
                        this.stopListening();
                    } else {
                        this.startListening();
                    }
                });
            }

            startListening() {
                if (this.recognition && !this.isListening) {
                    try {
                        this.recognition.start();
                        this.updateStatus('Listening... Speak naturally');
                        document.getElementById('confidenceBar').style.display = 'block';
                    } catch (error) {
                        console.error('Error starting recognition:', error);
                        this.updateStatus('Error starting voice recognition. Please try again.');
                    }
                }
            }

            stopListening() {
                if (this.recognition && this.isListening) {
                    this.recognition.stop();
                }
            }

            updateUI() {
                const micButton = document.getElementById('micButton');
                if (this.isListening) {
                    micButton.className = micButton.className.replace('from-blue-500 to-green-500', 'from-red-500 to-red-600');
                    micButton.classList.add('pulsing-mic');
                    micButton.innerHTML = 'ðŸ”´';
                } else {
                    micButton.className = micButton.className.replace('from-red-500 to-red-600', 'from-blue-500 to-green-500');
                    micButton.classList.remove('pulsing-mic');
                    micButton.innerHTML = 'ðŸŽ¤';
                }
            }

            updateStatus(message) {
                document.getElementById('status').textContent = message;
            }

            updateConfidence(confidence) {
                const confidenceLevel = document.getElementById('confidenceLevel');
                const percentage = Math.round(confidence * 100);
                confidenceLevel.style.width = percentage + '%';
                
                if (confidence >= 0.8) {
                    confidenceLevel.className = 'h-full bg-green-500 transition-all duration-300';
                } else if (confidence >= 0.5) {
                    confidenceLevel.className = 'h-full bg-yellow-500 transition-all duration-300';
                } else {
                    confidenceLevel.className = 'h-full bg-red-500 transition-all duration-300';
                }
            }

            updateTranscript(text) {
                const transcriptDiv = document.getElementById('transcript');
                const transcriptText = document.getElementById('transcriptText');
                transcriptText.textContent = text;
                transcriptDiv.style.display = text ? 'block' : 'none';
            }

            processVoiceInput(text) {
                console.log('Processing voice input:', text);
                this.addMessage('user', text);
                
                // Generate AI response
                setTimeout(() => {
                    const response = this.generateAIResponse(text);
                    this.addMessage('margaret', response);
                    this.speakResponse(response);
                }, 1000);
                
                this.updateStatus('Click the microphone to continue the conversation');
                this.updateTranscript('');
            }

            addMessage(sender, text) {
                const conversation = document.getElementById('conversation');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                
                if (sender === 'user') {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-bold">U</div>
                        <div class="flex-1 bg-blue-50 rounded-lg p-3">
                            <p class="text-blue-800">${text}</p>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold">M</div>
                        <div class="flex-1 bg-purple-50 rounded-lg p-3">
                            <p class="text-purple-800">${text}</p>
                        </div>
                    `;
                }
                
                conversation.appendChild(messageDiv);
                conversation.scrollTop = conversation.scrollHeight;
            }

            generateAIResponse(userInput) {
                const input = userInput.toLowerCase();
                
                // Context-aware responses based on input patterns
                if (input.includes('hello') || input.includes('hi')) {
                    return "Hello dear! It's wonderful to hear from you. I'm doing well today, thank you for asking. How has your day been treating you?";
                }
                
                if (input.includes('sad') || input.includes('down') || input.includes('upset')) {
                    return "Oh my dear, I'm sorry to hear you're feeling sad. You know, at my age, I've learned that sad feelings are like clouds - they pass through. Would you like to tell me what's on your mind? Sometimes talking helps.";
                }
                
                if (input.includes('happy') || input.includes('good') || input.includes('great')) {
                    return "How wonderful! It makes my heart happy to hear you're doing well. There's nothing like a good day to lift the spirits. What's been the highlight of your day?";
                }
                
                if (input.includes('tired') || input.includes('exhausted')) {
                    return "Oh dear, you sound tired. At my age, I've learned to listen to my body. Have you been getting enough rest? Sometimes a warm cup of tea and a few minutes of quiet can work wonders.";
                }
                
                if (input.includes('day') || input.includes('today')) {
                    return "Well, my day has been lovely, thank you for asking! I spent some time tending to my garden this morning - the roses are blooming beautifully. How has your day been, dear?";
                }
                
                if (input.includes('advice') || input.includes('help')) {
                    return "Oh, you're asking for advice from an old lady like me? Well, in my 78 years, I've learned that kindness costs nothing but means everything. And remember, dear - every day is a gift, that's why they call it the present.";
                }
                
                if (input.includes('thank')) {
                    return "You're so very welcome, dear! It's my pleasure to chat with you. At my age, good conversation is one of life's greatest treasures.";
                }
                
                // Default empathetic response
                return "I hear you, dear. At my age, I've learned that everyone has a story worth listening to. Please, tell me more about what's on your mind today.";
            }

            speakResponse(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.8;
                    utterance.pitch = 1.1;
                    utterance.volume = 0.8;
                    
                    // Try to use a female voice if available
                    const voices = speechSynthesis.getVoices();
                    const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('woman') || voice.name.includes('Zira'));
                    if (femaleVoice) {
                        utterance.voice = femaleVoice;
                    }
                    
                    speechSynthesis.speak(utterance);
                }
            }
        }

        // Initialize the demo when the page loads
        window.addEventListener('load', () => {
            new VoiceDemo();
        });
    </script>
</body>
</html>